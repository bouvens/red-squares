(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{27:function(e,t,r){r(28),e.exports=r(48)},46:function(e,t,r){},48:function(e,t,r){"use strict";r.r(t);var a={};r.r(a),r.d(a,"Mouse",function(){return S}),r.d(a,"Still",function(){return w}),r.d(a,"Random",function(){return z}),r.d(a,"Scared",function(){return C}),r.d(a,"Stable",function(){return N}),r.d(a,"Traveller",function(){return F});var n={};r.r(n),r.d(n,"game",function(){return U}),r.d(n,"hero",function(){return V}),r.d(n,"threats",function(){return $});var o={};r.r(o),r.d(o,"processSpacePress",function(){return de}),r.d(o,"clearHighest",function(){return fe}),r.d(o,"init",function(){return me});var i={};r.r(i),r.d(i,"setState",function(){return ve});var s,u,h,c=r(0),d=r.n(c),l=r(9),p=r(4),f=r(19),m=r(6),y=r(1),g=r.n(y),v="INIT",b="SET_STATE";var x=(u=s=function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),h.call(this),this.initialKeymap=t,e.instance)return e.instance;e.instance=this,document.onmousemove=this.saveMousePos,window.document.addEventListener("keydown",this.process)},s.mousePos={},s.keyPressed=[],h=function(){var e=this;this.initialKeymap={},this.saveMousePos=function(e){x.mousePos={x:e.pageX,y:e.pageY}},this.process=function(t){" "===t.key&&t.preventDefault(),e.saveKeyPressed(t)},this.saveKeyPressed=function(e){var t=e.keyCode;x.keyPressed.push(t)},this.reactToKeys=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.initialKeymap;x.keyPressed.forEach(function(e){return t[e]&&t[e]()}),x.keyPressed=[]}},u),S=function(e){var t=e.game.redSquares.getFieldSize();return{x:x.mousePos.x-t.left,y:x.mousePos.y-t.top}},w=function(e){return e.hero?{x:e.hero.x,y:e.hero.y}:{x:0,y:0}};function O(e,t){return Math.random()*(e-2*t)+t}var M=void 0,z=function(e){return(!M||e.hero.x===M.x&&e.hero.y===M.y)&&(M={x:O(e.game.fieldWidth,e.hero.size),y:O(e.game.fieldHeight,e.hero.size)}),M};function E(e){return Number.isNaN(parseFloat(e))}function P(e){return 0===e||E(e)?e:e>0?1:-1}var T=function(e,t){return{x:(e.fieldWidth-t)/2,y:(e.fieldHeight-t)/2}};var _=24,j=function(e,t){var r=e.x,a=e.y;return t.reduce(function(e,t){var n=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}({x:r,y:a},t);return!e.threat||e.distance>n?{threat:t,distance:n}:e},{threat:null,distance:1/0})},H=function(e,t){return(e.size+t.size+e.maxSpeed+t.maxSpeed)*(4/3)};function W(e,t,r,a){var n=[],o=e.x,i=e.y;return n.push({x:o,y:1.1*-t}),n.push({x:o,y:a+1.1*t}),n.push({x:1.1*-t,y:i}),n.push({x:r+1.1*t,y:i}),n}function R(e){for(var t=[],r=0;r<2*Math.PI;r+=2*Math.PI/_)t.push({x:e.x+Math.cos(r)*e.maxSpeed,y:e.y+Math.sin(r)*e.maxSpeed});return t}var C=function(e){var t=e.game,r=e.hero,a=e.threats,n=W(r,2*a.size,t.fieldWidth,t.fieldHeight),o=j(r,g.a.extend(n,a.threats));if(!o.threat||o.distance>2*H(r,a))return T(t,r.size);var i=r.x-o.threat.x,s=r.y-o.threat.y;return{x:r.x+i,y:r.y+s}},N=function(e){var t=e.game,r=e.hero,a=e.threats,n=W(r,2*a.size,t.fieldWidth,t.fieldHeight),o=a.threats.map(function(e){return{x:e.x+e.speed.x,y:e.y+e.speed.y}}),i=g.a.extend(n,o),s=j(r,i);if(!s.threat||s.distance>H(r,a))return T(t,r.size);var u=R(r).reduce(function(e,t){var r=j(t,i).distance;return r>e.distance?{x:t.x,y:t.y,distance:r}:e},{x:r.x,y:r.y,distance:s.distance});return{x:u.x,y:u.y}},L=function(e,t,r){return function(a,n){var o=a.x,i=a.y;return Math.min(j({x:o,y:i},n).distance,o+r,e+r-o,i+r,t+r-i)}};var q,F=function(e){var t=e.game,r=e.hero,a=e.threats,n=a.threats.map(function(e){return{x:e.x+e.speed.x,y:e.y+e.speed.y}}),o=r.size+a.size,i=L(t.fieldWidth,t.fieldHeight,o),s=i(r,n);if(s>H(r,a))return function(e,t,r,a){for(var n=0,o=void 0,i=void 0,s=L(t,r,e),u=e;u<t-e;u+=e)for(var h=e;h<r-e;h+=e){var c=s({x:u,y:h},a);c>n&&(n=c,o=u,i=h)}return{x:o,y:i}}(o,t.fieldWidth,t.fieldHeight,n);var u=R(r).reduce(function(e,t){var r=i(t,n);return r>e.distance?{x:t.x,y:t.y,distance:r}:e},{x:r.x,y:r.y,distance:s});return{x:u.x,y:u.y}},A={Normal:"Normal",Fast:"Fast",Faster:"Faster"},k={frameLength:30,fieldWidth:800,fieldHeight:600,sideWidth:200,shadowPeriod:1,shadowQuantity:50,speed:A.Fast,manager:g.a.findKey(a,function(e){return e===F}),heroSize:25,heroSpeed:10,threatSize:15,threatSpeed:4,threatLimit:20,threatAddTimeout:1e3,threatRemoveProbability:5},B={autoRestart:"game.autoRestart",speed:"game.speed",manager:"game.manager",heroSize:"hero.size",heroSpeed:"hero.maxSpeed",threatSize:"threats.size",threatSpeed:"threats.maxSpeed",threatLimit:"threats.limit",threatAddTimeout:"threats.addTimeout",threatRemoveProbability:"threats.removeProbability"},I="highestBeats",K={play:"play",pause:"pause",stop:"stop"},D=((q={})[K.play]="Pause",q[K.pause]="Resume",q[K.stop]="Start",q),G={space:32},Q={redSquares:null,inputController:null,manager:k.manager,status:K.stop,autoRestart:!0,beats:0,highestBeats:0,outs:0,frame:0,speed:k.speed,fieldWidth:k.fieldWidth,fieldHeight:k.fieldHeight,error:""},U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments[1];switch(t.type){case v:return g.a.extend({},e,t.data);case b:return g.a.extend({},e,t.data.game);default:return e}},X={normal:"normal",trouble:"trouble"},Y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},J=Y({},T(k,k.heroSize),{maxSpeed:k.heroSpeed,status:X.normal,size:k.heroSize,shadowPeriod:k.shadowPeriod,shadowQuantity:k.shadowQuantity,shadows:[],target:Y({},T(k,k.heroSize),{save:""})}),V=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J,t=arguments[1];switch(t.type){case b:return g.a.extend({},e,t.data.hero);default:return e}},Z={threats:[],size:k.threatSize,maxSpeed:k.threatSpeed,lastTime:0,addTimeout:k.threatAddTimeout,index:0,limit:k.threatLimit,removeProbability:k.threatRemoveProbability},$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,t=arguments[1];switch(t.type){case b:return g.a.extend({},e,t.data.threats);default:return e}},ee=(r(2),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}),te=function(e,t,r,a,n){var o=r+a;return n.some(function(r){return Math.abs(r.x-e)<o&&Math.abs(r.y-t)<o})?X.trouble:X.normal};var re=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},ae=function(e,t,r,a){return function(n){var o=re({},n),i=Math.random()<1/e,s=function(e,t,r){return function(a,n){var o=re({},e);return o.isGoingOut=P(n)===P(o.speed[a]),o.isOut||(r&&o.isGoingOut?o.isOut=!0:o.speed[a]=(o.isGoingOut?-1:1)*(o.speed[a]||1)),Math.abs(n)>3*t&&(o.isAroundField=!1),o}}(o,t,i),u=t;o.x<u&&(o=s("x",o.x-u));var h=r-t;o.x>h&&(o=s("x",o.x-h));var c=t;o.y<c&&(o=s("y",o.y-c));var d=a-t;return o.y>d&&(o=s("y",o.y-d)),o}},ne=function(e,t,r,a,n){var o=2*e,i=Math.round(Math.random()*(r-o)),s=0-o,u={x:Math.round((2*Math.random()-1)*n),y:Math.ceil(Math.random()*n)};return Math.random()<.5?(i=0-o,s=Math.round(Math.random()*(a-o)),u={x:Math.ceil(Math.random()*n),y:Math.round((2*Math.random()-1)*n)},Math.random()<.5&&(i=r,u.x*=-1)):Math.random()<.5&&(s=a,u.y*=-1),{id:t,x:i,y:s,speed:u,isOut:!1,isAroundField:!0}};var oe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},ie=function(e,t){return g.a.merge({},e,{game:{status:t}})};function se(e){switch(e.game.status){case K.play:return ie(e,K.pause);case K.pause:return ie(e,K.play);case K.stop:default:return oe({},e,{game:oe({},e.game,{status:K.play,beats:0,outs:0,frame:0,error:""}),hero:oe({},e.hero,T(e.game,e.hero.size)),threats:oe({},e.threats,{threats:[],lastTime:-e.threats.addTimeout/k.frameLength})})}}function ue(e){var t=g.a.merge({},e,{hero:{target:a[e.game.manager](e)}});return(E(t.hero.target.x)||E(t.hero.target.y))&&(t.game.error="Bad target",t.hero.target=oe({},t.hero.target,{x:t.hero.x,y:t.hero.y})),t}var he=Object(p.d)(function(e){var t=e.threats,r=e.game,a=r.frame,n=r.fieldWidth,o=r.fieldHeight,i=k.frameLength,s=function(e,t,r){var a=e.threats,n=e.removeProbability,o=e.size;return a.map(function(e){return re({},e,{x:e.x+e.speed.x,y:e.y+e.speed.y})}).map(ae(n,o,t,r)).filter(function(e){return e.isAroundField})}(t,n,o),u=t.threats.length-s.length,h=function(e){var t=0;return{beatenThreats:e.map(function(e){var r=re({},e);return r.isGoingOut&&!r.isOut&&(t+=1,delete r.isGoingOut),r},0),beats:t}}(s),c=h.beatenThreats,d=h.beats,l=function(e){var t=e.newThreats,r=e.threats,a=e.frame,n=e.fieldWidth,o=e.fieldHeight,i=e.frameLength,s=[].concat(t),u=!1;return t.length<r.limit&&a>=r.lastTime+r.addTimeout/i&&(s.push(ne(r.size,r.index,n,o,r.maxSpeed)),u=!0),{addedThreats:s,isAdded:u}}({newThreats:s=c,threats:t,frame:a,fieldWidth:n,fieldHeight:o,frameLength:i}),p=l.addedThreats,f=l.isAdded;s=p;var m=g.a.merge({},e,{game:{beats:e.game.beats+d,outs:e.game.outs+u},threats:f?{lastTime:a,index:t.index+1}:t});return m.threats.threats=s,m},ue,function(e){var t=e.game,r=e.hero,a=e.threats.threats,n=e.threats.size,o=function(e,t){var r=t.x-e.x,a=t.y-e.y,n=Math.sqrt(Math.pow(r,2)+Math.pow(a,2));if(n<=e.maxSpeed)return{xMove:r,yMove:a};var o=n/e.maxSpeed;return{xMove:r/o,yMove:a/o}}(r,r.target),i=o.xMove,s=o.yMove,u=r.x+i;u=Math.max(u,r.size),u=Math.min(u,t.fieldWidth-r.size);var h=r.y+s;h=Math.max(h,r.size),h=Math.min(h,t.fieldHeight-r.size);var c=te(u,h,r.size,n,a);return ee({},e,{game:ee({},e.game,{status:c===X.normal?K.play:K.stop}),hero:ee({},e.hero,{x:u,y:h,status:c,shadows:function(e){var t=e.game,r=e.hero,a=r.shadows,n=r.shadowPeriod,o=r.shadowQuantity,i=r.x,s=r.y;return t.frame%n||(a.length===o&&a.pop(),a.unshift({x:i,y:s,id:a.length?a[0].id+1:0})),a}(e)})})});function ce(e){var t=function(e){var t,r=oe({},e);return r.game.status===K.stop&&r.game.autoRestart?r=se(r=ue(r)):r.game.inputController.reactToKeys(((t={})[G.space]=function(){r=se(r)},t)),r}(e);return t.game.status===K.play&&((t=he(t)).game.frame+=1),t}function de(){return function(e,t){e({type:b,data:se(t())})}}var le=function(e,t){return Math.max(t+k.frameLength-performance.now(),0)},pe=function(e){var t=ce(e);return t.game.status===K.stop&&e.game.status===K.play&&(t.game.highestBeats=Math.max(t.game.beats,t.game.highestBeats),function(e){localStorage.setItem(I,e)}(t.game.highestBeats)),t};function fe(){return function(e){localStorage.removeItem(I),e({type:v,data:{highestBeats:0}})}}function me(e){return function(t,r){t({type:v,data:{redSquares:e,inputController:new x,highestBeats:function(){var e=localStorage[I];return e?parseInt(e,10):0}()}}),function e(t,r,a){return function(){var n=r(),o=pe(n);if(o.game.speed===A.Faster)for(var i=1;i<=100;i+=1)o=pe(o);o.game.status!==K.play&&n.game.status!==K.play||t({type:b,data:o}),setTimeout(e(t,r,performance.now()),o.game.speed===A.Normal?le(o,a):0)}}(t,r)()}}var ye,ge,ve=function(e,t){return{type:b,data:g.a.set({},e,t)}},be=r(7),xe=r.n(be);function Se(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var we,Oe=((ye={})[X.normal]="rgb(50, 205, 50)",ye[X.trouble]="rgb(237, 20, 61)",ye),Me=Object(m.b)(function(e){return{fieldWidth:e.game.fieldWidth,fieldHeight:e.game.fieldHeight,heroStatus:e.hero.status,heroSize:e.hero.size,heroPos:{x:e.hero.x,y:e.hero.y},threatSize:e.threats.size,threats:e.threats.threats,shadows:e.hero.shadows,error:e.game.error}})(ge=function(e){function t(){var r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];return r=a=Se(this,e.call.apply(e,[this].concat(o))),a.canvas=null,a.clear=function(){a.canvas.clearRect(0,0,a.props.fieldWidth,a.props.fieldHeight)},a.drawSquare=function(e){var t=e.pos,r=e.size,n=e.color;a.canvas.fillStyle=n,a.canvas.fillRect(Math.round(t.x-r),Math.round(t.y-r),2*r,2*r)},a.paint=function(){a.clear(),a.props.shadows.forEach(function(e,t){return a.drawSquare({pos:a.props.shadows[t],size:a.props.heroSize,color:"rgba(237, 20, 61, "+(a.props.shadows.length-t-1)/a.props.shadows.length*.2+")"})}),a.drawSquare({pos:a.props.heroPos,size:a.props.heroSize,color:Oe[a.props.heroStatus]}),a.props.threats.forEach(function(e){return a.drawSquare({pos:e,size:a.props.threatSize,color:"rgb(100, 149, 237)"})})},a.handleRefCanvas=function(e){a.canvas=e.getContext("2d"),a.props.refHandler(e)},Se(a,r)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentDidMount=function(){this.paint()},t.prototype.componentDidUpdate=function(){this.paint()},t.prototype.render=function(){return d.a.createElement("div",{className:xe.a.fieldWrapper},d.a.createElement("canvas",{className:xe.a.field,ref:this.handleRefCanvas,width:this.props.fieldWidth,height:this.props.fieldHeight},"You are using an outdated browser."),d.a.createElement("div",{className:xe.a.error},this.props.error))},t}(d.a.PureComponent))||ge,ze=r(3);function Ee(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var Pe,Te,_e,je=Object(m.b)(Object(ze.e)(function(e){return{status:e.game.status,beats:e.game.beats,highestBeats:e.game.highestBeats,outs:e.game.outs,threatsLength:e.threats.threats.length,manager:e.game.manager}},B),function(e){return Object(p.b)({processSpacePress:o.processSpacePress,setState:i.setState,clearHighest:o.clearHighest},e)})(we=function(e){function t(){var r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];return r=a=Ee(this,e.call.apply(e,[this].concat(o))),a.changeHandler=a.props.setState,a.getS=function(e,t){return(t||"No")+" "+e+(1!==t?"s":"")},Ee(a,r)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(){return d.a.createElement("div",{className:xe.a.side,style:{width:k.sideWidth+"px"}},d.a.createElement("button",{type:"button",onClick:this.props.processSpacePress},D[this.props.status])," (Press Space)",d.a.createElement("h2",null,this.getS("beat",this.props.beats)),d.a.createElement("p",null,"Highest beats: ",this.props.highestBeats),d.a.createElement("p",null,this.getS("out",this.props.outs)),d.a.createElement("p",null,this.getS("threat",this.props.threatsLength)," on field"),d.a.createElement(ze.b,{state:Object(ze.f)(this.props,B),onChange:this.changeHandler,defaultNum:1},d.a.createElement(ze.a,{id:B.autoRestart,label:"Auto restart"}),d.a.createElement(ze.d,{id:B.speed,label:"Speed",values:g.a.keys(A)}),d.a.createElement(ze.d,{id:B.manager,label:"Control",values:g.a.keys(a)}),d.a.createElement(ze.c,{id:B.heroSize,label:"Hero size (px)"}),d.a.createElement(ze.c,{id:B.heroSpeed,label:"Hero max speed (px/s)"}),d.a.createElement(ze.c,{id:B.threatSize,label:"Threat size (px)"}),d.a.createElement(ze.c,{id:B.threatSpeed,label:"Threat max speed (px/s)"}),d.a.createElement(ze.c,{id:B.threatLimit,label:"Threat limit"}),d.a.createElement(ze.c,{id:B.threatAddTimeout,label:"Threat add timeout (ms)"}),d.a.createElement(ze.c,{id:B.threatRemoveProbability,label:"Threat remove probability (1/x)"})),d.a.createElement("button",{type:"button",onClick:this.props.clearHighest},"Clear highest"))},t}(d.a.Component))||we;function He(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var We=d.a.createElement(je,null),Re=Object(m.b)(function(e){return{fieldWidth:e.game.fieldWidth}},function(e){return Object(p.b)({init:o.init},e)})((_e=Te=function(e){function t(){var r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];return r=a=He(this,e.call.apply(e,[this].concat(o))),a.getFieldSize=function(){var e=a.field;return{left:e.offsetLeft,top:e.offsetTop,right:e.offsetLeft+e.clientWidth,bottom:e.offsetTop+e.clientHeight}},a.handleRefField=function(e){a.field=e},He(a,r)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentDidMount=function(){this.props.init(this)},t.prototype.render=function(){return d.a.createElement("div",{className:xe.a.wrapper,style:{width:this.props.fieldWidth+k.sideWidth+"px"}},d.a.createElement(Me,{refHandler:this.handleRefField}),We)},t}(d.a.Component),Te.defaultProps={fieldWidth:800,init:g.a.noop},Pe=_e))||Pe,Ce=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||p.d,Ne=Object(p.e)(Object(p.c)(n),Ce(Object(p.a)(f.a))),Le=d.a.createElement(m.a,{store:Ne},d.a.createElement(Re,null)),qe=function(){return Le};r(46);Object(l.render)(d.a.createElement(qe,null),document.querySelector("#app"))},7:function(e,t,r){e.exports={wrapper:"RedSquares__wrapper__n469N",fieldWrapper:"RedSquares__fieldWrapper__3xRFe",field:"RedSquares__field__3S_U-",error:"RedSquares__error__32Ynw",side:"RedSquares__side__1Qama"}}},[[27,2,1]]]);
//# sourceMappingURL=app.1b771c48.js.map